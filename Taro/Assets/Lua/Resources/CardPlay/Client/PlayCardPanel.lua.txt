require('CardPlay.Client.PokeObjSet')

PlayCardPanel = {}

local canvas = assert(CS.UnityEngine.GameObject.Find("Canvas"))
local myHandSet = PokeObjSet:New(assert(CS.UnityEngine.GameObject.Find("MyHand")))

PlayInfoArea = {}

function PlayInfoArea:Create(areaName)
    local ui = setmetatable({}, { __index = self })
    ui.area = assert(canvas.transform:Find(areaName).gameObject)
    ui.playerNameTxt = assert(ui.area.transform:Find("PlayerNameTxt").gameObject:GetComponent(typeof(CS.UnityEngine.UI.Text)))
    ui.handsNumTxt = assert(ui.area.transform:Find("HandsNumTxt").gameObject:GetComponent(typeof(CS.UnityEngine.UI.Text)))
    return ui
end

function PlayInfoArea:Show(playerName, handsNum)
    self.area:SetActive(true)
    self.playerNameTxt.text = playerName
    self:UpdateHandsNum(handsNum)
end

function PlayInfoArea:SetData(info)
    self:UpdateHandsNum(info.handNum)
end

function PlayInfoArea:UpdateHandsNum(handsNum)
    self.handsNumTxt.text = "手牌数量："..handsNum
end

local upPlayInfoArea = PlayInfoArea:Create("UpstreamPlayInfo")
local downPlayInfoArea = PlayInfoArea:Create("DownstreamPlayInfo")
local myPlayInfoArea = PlayInfoArea:Create("MyPlayInfo")

function PlayCardPanel:Show()
    upPlayInfoArea:Show("上游玩家", 0)
    downPlayInfoArea:Show( "下游玩家", 0)
    myPlayInfoArea:Show("我方玩家", 0)
end

function PlayCardPanel:SetData_AfterDeal(data)
    upPlayInfoArea:SetData(data.upstreamInfo)
    downPlayInfoArea:SetData(data.downstreamInfo)
    myPlayInfoArea:SetData(data.meInfo)

    local myHands = data.meInfo.hands
    myHandSet:SetData(myHands)
end

