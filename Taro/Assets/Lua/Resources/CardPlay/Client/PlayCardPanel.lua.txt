require('CardPlay.Client.PokeObjSet')
require('CardPlay.Client.Button')

PlayCardPanel = {}

local canvas = assert(CS.UnityEngine.GameObject.Find("Canvas"))
local myHandSet = PokeObjSet:New(assert(CS.UnityEngine.GameObject.Find("MyHand")))
local playCardBtn = Button:New(assert(canvas.transform:Find("PlayCardButton").gameObject))
local giveUpBtn = Button:New(assert(canvas.transform:Find("GiveUpButton").gameObject))

PlayInfoArea = {}

function PlayInfoArea:Create(areaName)
    local ui = setmetatable({}, { __index = self })
    ui.area = assert(canvas.transform:Find(areaName).gameObject)
    ui.playerNameTxt = assert(ui.area.transform:Find("PlayerNameTxt").gameObject:GetComponent(typeof(CS.UnityEngine.UI.Text)))
    ui.handsNumTxt = assert(ui.area.transform:Find("HandsNumTxt").gameObject:GetComponent(typeof(CS.UnityEngine.UI.Text)))
    ui.turnMark = assert(ui.area.transform:Find("TurnMark").gameObject)
    return ui
end

function PlayInfoArea:Show(playerName, handsNum)
    self.area:SetActive(true)
    self.playerNameTxt.text = playerName
    self.turnMark:SetActive(false)
    self:UpdateHandsNum(handsNum)
end

function PlayInfoArea:SetData(info)
    self:UpdateHandsNum(info.handNum)
    self.turnMark:SetActive(info.isTurnPlayer == true)
end

function PlayInfoArea:UpdateHandsNum(handsNum)
    self.handsNumTxt.text = "手牌数量："..handsNum
end

local upPlayInfoArea = PlayInfoArea:Create("UpstreamPlayInfo")
local downPlayInfoArea = PlayInfoArea:Create("DownstreamPlayInfo")
local myPlayInfoArea = PlayInfoArea:Create("MyPlayInfo")

function PlayCardPanel:Show()
    upPlayInfoArea:Show("上游玩家", 0)
    downPlayInfoArea:Show( "下游玩家", 0)
    myPlayInfoArea:Show("我方玩家", 0)
end

function PlayCardPanel:SetData_AfterDeal(data)
    upPlayInfoArea:SetData(data.upstreamInfo)
    downPlayInfoArea:SetData(data.downstreamInfo)
    myPlayInfoArea:SetData(data.meInfo)

    local myHands = data.meInfo.hands
    myHandSet:SetData(myHands)
end

function PlayCardPanel:SetData_StartPlayCard(data)
    upPlayInfoArea:SetData(data.upstreamInfo)
    downPlayInfoArea:SetData(data.downstreamInfo)
    myPlayInfoArea:SetData(data.meInfo)

    local myHands = data.meInfo.hands
    myHandSet:SetData(myHands)

    playCardBtn:Show()
    giveUpBtn:Show()
    playCardBtn:SetEnable(false)
    giveUpBtn:SetEnable(false)
end

